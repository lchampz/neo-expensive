var ne=Object.defineProperty,le=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var J=(h,d,a)=>d in h?ne(h,d,{enumerable:!0,configurable:!0,writable:!0,value:a}):h[d]=a,Q=(h,d)=>{for(var a in d||(d={}))se.call(d,a)&&J(h,a,d[a]);if(V)for(var a of V(d))oe.call(d,a)&&J(h,a,d[a]);return h},X=(h,d)=>le(h,de(d));import{r as l,u as ae,q as ce,E as ie,h as ue}from"./vendor.e0ff885f.js";import{i as R,I as v}from"./index.6a81ea0c.js";import{M as he}from"./index.b61e5bbc.js";import{P as pe,j as t,a as r,A as me}from"./index.dfd5fa78.js";import{B as C}from"./index.173b51a7.js";function ke(){var O,T;const h=l.exports.useRef(null),d=l.exports.useRef(null),a=l.exports.useRef(null),y=l.exports.useRef(null),E=ae(),z=ce(),n=ie(me,e=>e.user),{addAddress:I,removeAddress:B,addCard:q,removeCard:M,createOrder:j,products:G}=ue(pe),[D,p]=l.exports.useState(!1),[k,H]=l.exports.useState(""),[F,K]=l.exports.useState(""),[i,N]=l.exports.useState(0),[x,$]=l.exports.useState([]),[S,w]=l.exports.useState(1),[u]=l.exports.useState(()=>G.find(e=>e.id===z.id)||null);l.exports.useEffect(()=>{n||E("/"),u||E("/")},[E,u,n]);const b=l.exports.useMemo(()=>{const e=(u==null?void 0:u.price)*S,o=x.map(({price:s})=>s).reduce((s,c)=>s+c,0);return Math.max(e-o,0)},[x,u==null?void 0:u.price,S]),L=l.exports.useCallback(({coupon:e})=>{var m,g;const o=JSON.parse(localStorage.getItem("@neo:coupon")||"[]");if(!o.find(({title:f})=>e===f)){(m=a.current)==null||m.setFieldError("coupon","That coupon does't exist");return}if(x.find(({title:f})=>f===e)){(g=a.current)==null||g.setFieldError("coupon","That coupon is already applied");return}const c=o.find(({title:f})=>e===f);c&&$(f=>[...f,X(Q({},c),{title:e})])},[x]),U=l.exports.useCallback(e=>{$(o=>o.filter(s=>s.id!==e))},[]),W=l.exports.useCallback(()=>{p(!1),N(e=>e+1)},[]),Y=l.exports.useCallback(()=>{p(!0),N(e=>e-1)},[]),Z=l.exports.useCallback(({cep:e,neighborhood:o,street:s})=>{var c,m,g,f;if((c=n==null?void 0:n.addresses)==null?void 0:c.find(P=>P.cep===e)){(m=d.current)==null||m.setFieldError("cep","An address with this CEP already exists.");return}if((g=n==null?void 0:n.addresses)==null?void 0:g.find(P=>P.street===s)){(f=d.current)==null||f.setFieldError("street","An address with this street already exists.");return}I({cep:e,neighborhood:o,street:s})},[I,n==null?void 0:n.addresses]),A=l.exports.useCallback(()=>{var e,o;if(p(!1),i===0){p(!0);return}if(i===1){if(!k){p(!1);return}if(k){p(!0);return}if(d.current){const{cep:s,street:c,neighborhood:m}=(e=d.current)==null?void 0:e.getData();if(!s||!c||!m){p(!1);return}}}if(i===2){if(!F){p(!1);return}if(F){p(!0);return}if(y.current){const{cvv:s,expiration:c,number:m}=(o=y.current)==null?void 0:o.getData();if(!s||!c||!m){p(!1);return}}}},[k,F,i]),_=l.exports.useCallback(e=>{B(e)},[B]),ee=l.exports.useCallback(({number:e,expiration:o,cvv:s})=>{q({expiration:o,cvv:s,number:e})},[q]),re=l.exports.useCallback(e=>{M(e)},[M]),te=l.exports.useCallback(()=>{j({selectedAddressId:k,selectedCardId:F,cart:n==null?void 0:n.cart,coupons:x,total:b}),E("/checkout/success")},[x,j,E,k,F,b,n==null?void 0:n.cart]);return t("div",{children:[t("header",{children:[i===0&&r("h1",{children:"carrinho"}),i===1&&r("h1",{children:"entrega"}),i===2&&r("h1",{children:"pagamento"})]}),t("main",{children:[i===0&&r("div",{children:r("ul",{children:t("li",{children:[t("div",{children:[u==null?void 0:u.name," - ",u==null?void 0:u.price]}),r("div",{children:S}),t("div",{children:[r(C,{onClick:()=>w(e=>e+1),children:"+"}),r(C,{disabled:S===1,onClick:()=>w(e=>e-1),children:"-"})]})]})})}),i===1&&t("div",{children:[r(C,{onClick:()=>{var e;return(e=h.current)==null?void 0:e.handleOpenModal()},children:"Add a new address"}),r("fieldset",{children:r("ul",{children:(O=n==null?void 0:n.addresses)==null?void 0:O.map(({id:e,cep:o,street:s})=>t("li",{children:[t("label",{htmlFor:e,children:[r("input",{name:"address",value:e,id:e,type:"radio",onFocus:c=>{H(c.target.value),p(!0)}}),o," - ",s]}),r("button",{onClick:()=>_(e),children:"remove"})]},e))})}),r(he,{ref:h,visible:!1,children:t(R,{ref:d,onSubmit:Z,children:[r(v,{onChange:A,required:!0,name:"cep",label:"Enter your CEP",placeholder:"Cep",onBlur:()=>{var e;return(e=d.current)==null?void 0:e.setFieldError("cep","")},onFocus:()=>{var e;return(e=d.current)==null?void 0:e.setFieldError("cep","")}}),r(v,{onChange:A,required:!0,name:"street",label:"Enter your street",placeholder:"Street",onBlur:()=>{var e;return(e=d.current)==null?void 0:e.setFieldError("street","")},onFocus:()=>{var e;return(e=d.current)==null?void 0:e.setFieldError("street","")}}),r(v,{onChange:A,required:!0,name:"neighborhood",label:"Enter your neighborhood",placeholder:"Neighborhood"}),r(v,{name:"complement",label:"Enter your complement",placeholder:"Complement"}),r(C,{type:"submit",children:"Add address"})]})})]}),i===2&&t("div",{children:[t("ul",{children:[r("li",{children:"cart\xE3o"}),r("li",{children:"pix"})]}),t("ul",{children:[r("li",{children:t(R,{ref:y,onSubmit:ee,children:[r(v,{name:"number",label:"Card number",placeholder:"0000.000.0"}),r(v,{name:"expiration",label:"Card expiration",placeholder:"12/12"}),r(v,{name:"cvv",label:"CVV",placeholder:"021"}),r(C,{type:"submit",children:"create card"})]})}),(T=n==null?void 0:n.cards)==null?void 0:T.map(({id:e,number:o,expiration:s,cvv:c})=>t("li",{children:[t("label",{htmlFor:e,children:[r("input",{id:e,name:"card",value:e,type:"radio",onFocus:m=>{K(m.target.value),p(!0)}}),s," - ",c]}),r("strong",{children:o}),r("button",{onClick:()=>re(e),children:"delete"})]},e))]})]})]}),t("aside",{children:[t(R,{ref:a,onSubmit:L,children:[r(v,{name:"coupon",label:"Enter a coupon",placeholder:"Enter any coupon",onFocus:()=>{var e;return(e=a.current)==null?void 0:e.setFieldError("coupon","")},onBlur:()=>{var e;return(e=a.current)==null?void 0:e.setFieldError("coupon","")}}),r(C,{variant:"3D",children:"Apply"})]}),r("div",{children:r("ul",{children:x==null?void 0:x.map(e=>r("li",{children:t("p",{style:{color:"green"},children:["coupons: ",e==null?void 0:e.title," - ",e.price,r(C,{onClick:()=>U(e.id),children:"X"})]})},e.id))})}),r("div",{children:t("h3",{children:["$",b-b*.1]})}),t("div",{children:[t("h3",{children:["$",b-b*.1]}),t("p",{children:["12x de $",((b-b*.1)/10).toFixed(2)]}),r("p",{children:"sem juros"})]}),t("div",{children:[t("h3",{children:["$",b]}),r("p",{children:"10% de desconto"})]}),i>0&&r("div",{children:r(C,{onClick:Y,children:"Back"})}),i===2&&r("div",{children:r(C,{disabled:!D,onClick:te,children:"submit"})}),r("div",{children:r(C,{disabled:i!==0&&!D||i===2,onClick:W,children:"Next"})})]})]})}export{ke as default};
